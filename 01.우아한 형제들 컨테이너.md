# 데이터 처리도 이제는 컨테이너로, 우아한 형제들의 데이터 플랫폼 혁신

- 컨테이너로 데이터를 처리할 경우 얻을 수 있는 이점

## 컨테이너로 데이터 처리하기

- 데이터가 중요한 시대
  - 다음과 같은 데이터 처리의 어려움이 있다.
    - 인프라 구성, 다양한 데이터 프레임워크, 다양한 데이터 포멧, 빠르게 변화하는 비즈니스 ,급격한 데이터양 증가
  - 다양한 요구사항 속에서도 데이터를 처리하기 위해서는 유연성을 확보해야 한다.
    - 이 유연성이라는 키워드는 컨테이너에 아주 적합한

컨테이너 이미지 기반 패키징 + 빠르고 유연한 컴퓨팅 자원 확보, 데이터 프로세싱

컨테이너 안에서 데이터를 처리하게 되면 컨테이너의 이점을 그대로 가져갈 수 있다.

AWS에는 EMR ON EKS가 있다.

- 하나의 EMR워크로드는 다수의 팟(또는 여러개의 컨테이너)으로 구성
- EMR 워크로드는 필요한 코드, 라이브러리는 컨테이너 이미지에 내장
- EMRFS/S3를 데이터 저장소로 활용

### EMR ON EKS의 장점은

- 빠르고 유연한 컴퓨팅 자원 활용
  - 다양한 크기의 인스턴스를 손쉽게 혼용하여 구성 가능
- 워크로드 통합
  - 하나의 EKS클러스터에서 다양한 EMR워크로드 처리 가능

### 배민은 기본적으로 점심, 저녁 시간에 트래픽이 엄청나게 몰림

- 하루에 백만 건 이상의 주문이 생기는데 어떻게 데이터를 처리할까

#### EC2 기반 플랫폼 한계

- 비용 증가 : EMR 고정 비용, 신규 EC2 다칩 미적용, 오버프로비저닝
- 낮은 민첩성 : 불규칙한 대량 트래픽, 개발/운영 환경 대응, 자원 경합
- 어려운 유지 보수: 태스크별 의존성 주입, 보안그룹과 방화벽 설정, EMR 버전 업그레이드

### 컨테이너 환경으로 재탄생

1. 기존 데이터 플랫폼 한계점 봉착
2. Airflow dlrhks : EKS 클러스터로 Airflow이관 및 cloud-native 역량 확보
3. 데이터 처리 시스템 : EMR on EKS 를 포함한 데이터 처리 시스템을 이관
4. 데이터 분석 이관

### EMR ON EKS효과

1. 비용 개선 : 상시 운용 노드가 없음 , Karpenter/Yunikorn으로 효율적인 스케일링
2. 통합 자원 활용: 개발- 배포 리드타임 감소
3. 강력한 자원 격리: 도커나 쿠버에서 기본으로 이야기하는건데 특정 컨테이너가 자원을 과도하게 소모한다던지 이런 경우가 거의 없다.

아파치 유니콘은 고급 스케줄링을 활용할 수 있게 한다.

- 자원ㄱ 경합 방지
- bin packing : 과도한 프로비저닝 방지, 가능한 Pod를 같은 노드 또는 AZ 배치

### EMR ON EKS의 특징

- 모니터링 환경 구축
  - Spark History서버
  - 클러스터 작업 이력 통합
- 로그 및 메트릭 수집
  - Job Runner, Spark Driver
- 성능 최적화를 위한 로그로 도움을 받을 수 있다.

### 배민은 미래에 어떻게 방향을 잡을까

- 데이터 조회시에 Trino, Ranger를 활용해 접근 권한 제어 및 마스킹 작업 진행
- EMR On EKS는 AWS LAke Formation을 활용한 권한 제어 예정
- IDC 자원의 활요ㅗㅇ
